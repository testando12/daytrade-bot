<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day Trade Bot</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="app-layout">

  <!-- =================== SIDEBAR =================== -->
  <aside class="sidebar" id="sidebar">

    <a class="sidebar-logo" href="#" onclick="navigate('dashboard')">
      <div class="logo-icon">üìà</div>
      <div class="logo-text">Day<span>Trade</span> Bot</div>
    </a>

    <nav class="sidebar-nav">

      <div class="nav-section">
        <div class="nav-section-label">Principal</div>
        <a class="nav-item active" data-page="dashboard" onclick="navigate('dashboard')">
          <span class="nav-icon">üè†</span>
          <span class="nav-label">Dashboard</span>
          <span class="nav-tooltip">Dashboard</span>
        </a>
        <a class="nav-item" data-page="live" onclick="navigate('live')">
          <span class="nav-icon">‚ö°</span>
          <span class="nav-label">An√°lise ao Vivo</span>
          <span class="nav-tooltip">An√°lise ao Vivo</span>
        </a>
        <a class="nav-item" data-page="market" onclick="navigate('market')">
          <span class="nav-icon">üíπ</span>
          <span class="nav-label">Mercado</span>
          <span class="nav-tooltip">Mercado</span>
        </a>
        <a class="nav-item" data-page="trade" onclick="navigate('trade')">
          <span class="nav-icon">üí±</span>
          <span class="nav-label">Trade</span>
          <span class="nav-tooltip">Trade</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">Gest√£o</div>
        <a class="nav-item" data-page="portfolio" onclick="navigate('portfolio')">
          <span class="nav-icon">üíº</span>
          <span class="nav-label">Portf√≥lio</span>
          <span class="nav-tooltip">Portf√≥lio</span>
        </a>
        <a class="nav-item" data-page="risk" onclick="navigate('risk')">
          <span class="nav-icon">üõ°Ô∏è</span>
          <span class="nav-label">Gest√£o de Risco</span>
          <span class="nav-tooltip">Gest√£o de Risco</span>
        </a>
        <a class="nav-item" data-page="history" onclick="navigate('history')">
          <span class="nav-icon">üìö</span>
          <span class="nav-label">Hist√≥rico</span>
          <span class="nav-tooltip">Hist√≥rico</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">Sistema</div>
        <a class="nav-item" data-page="settings" onclick="navigate('settings')">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span class="nav-label">Configura√ß√µes</span>
          <span class="nav-tooltip">Configura√ß√µes</span>
        </a>
      </div>

    </nav>

    <div class="sidebar-footer">
      <div class="nav-item" style="pointer-events:none; margin-bottom:6px;">
        <span class="nav-icon">üîå</span>
        <span class="nav-label" id="sidebar-api-label" style="font-size:12px;">Conectando...</span>
        <div class="status-dot offline" id="sidebar-status-dot"></div>
      </div>
      <button class="sidebar-collapse-btn" onclick="toggleSidebar()">
        <span class="nav-icon">‚óÄ</span>
        <span class="nav-label">Recolher</span>
      </button>
    </div>

  </aside>

  <!-- =================== MAIN =================== -->
  <div class="main-content" id="main-content">

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-breadcrumb">
        <span>DayTrade Bot</span>
        <span style="color:var(--border)">‚Ä∫</span>
        <span class="current" id="topbar-page-name">Dashboard</span>
      </div>
      <div class="topbar-right">
        <div class="topbar-pill" id="api-status-pill">
          <div class="dot red" id="api-dot"></div>
          <span id="api-label">Conectando...</span>
        </div>
        <div class="topbar-pill" id="last-update-pill" style="display:none">
          <span>üïê</span>
          <span id="last-update-time">--:--</span>
        </div>
        <button class="btn btn-primary" onclick="refreshCurrentPage()">
          <span>‚Üª</span> Atualizar
        </button>
      </div>
    </header>

    <!-- PAGE CONTENT -->
    <main class="page-content" id="page-content">

      <!-- =========================================
           PAGE: DASHBOARD
           ========================================= -->
      <div id="page-dashboard" class="page active">
        <div class="page-title">Dashboard</div>
        <div class="page-subtitle">Vis√£o geral do bot em tempo real</div>

        <!-- KPIs -->
        <div class="cards-grid cards-4" id="dashboard-kpis">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Capital Total</span>
              <div class="card-icon blue">üí∞</div>
            </div>
            <div class="kpi-value" id="kpi-capital">R$ --</div>
            <div class="kpi-label">Capital atual do bot</div>
            <div class="kpi-change" id="kpi-pnl" style="margin-top:4px">P&L: --</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">IRQ Risco</span>
              <div class="card-icon green">üõ°Ô∏è</div>
            </div>
            <div class="kpi-value" id="kpi-irq">--%</div>
            <div class="kpi-label" id="kpi-irq-label">N√≠vel de risco do mercado</div>
            <div class="kpi-change neutral" id="kpi-irq-level">‚Äî</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Melhor Ativo</span>
              <div class="card-icon yellow">‚≠ê</div>
            </div>
            <div class="kpi-value" id="kpi-best-asset">--</div>
            <div class="kpi-label">Maior momentum score</div>
            <div class="kpi-change up" id="kpi-best-score">Score: --</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Status Bot</span>
              <div class="card-icon green">ü§ñ</div>
            </div>
            <div class="kpi-value" id="kpi-bot-status" style="font-size:18px">--</div>
            <div class="kpi-label">Estado do sistema</div>
            <div class="kpi-change" id="kpi-trade-ok">‚Äî</div>
          </div>
        </div>

        <!-- Row: Momentum Chart + Risk Radar -->
        <div class="cards-grid cards-2-1 mt-16">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Momentum por Ativo</span>
              <span id="dashboard-momentum-time" style="font-size:11px;color:var(--text-muted)"></span>
            </div>
            <div class="chart-container" style="height:240px">
              <canvas id="chart-momentum"></canvas>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Sinais de Risco</span>
              <span class="badge badge-green" id="irq-badge-dash">NORMAL</span>
            </div>
            <div class="chart-container" style="height:240px">
              <canvas id="chart-risk-radar"></canvas>
            </div>
          </div>
        </div>

        <!-- Row: Prices + Allocation -->
        <div class="cards-grid cards-2 mt-16">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Pre√ßos ao Vivo (Binance)</span>
              <button class="btn btn-secondary btn-sm" onclick="loadMarketPrices()">‚Üª</button>
            </div>
            <div id="dash-prices-table">
              <div class="loading-overlay"><div class="spinner"></div> Carregando...</div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Aloca√ß√£o de Capital</span>
              <span id="allocation-total" class="text-muted" style="font-size:12px"></span>
            </div>
            <div id="dash-allocation">
              <div class="loading-overlay"><div class="spinner"></div> Calculando...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- =========================================
           PAGE: AN√ÅLISE AO VIVO
           ========================================= -->
      <div id="page-live" class="page">
        <div class="page-title">‚ö° An√°lise ao Vivo</div>
        <div class="page-subtitle">An√°lise completa com dados reais da Binance ‚Äî Momentum + IRQ + Aloca√ß√£o</div>

        <div class="flex items-center gap-12 mb-16">
          <button class="btn btn-primary" onclick="loadLiveAnalysis()">
            ‚ö° Analisar Agora (Binance Live)
          </button>
          <button class="btn btn-secondary" onclick="loadFullAnalysis()">
            üß™ Analisar (Dados de Teste)
          </button>
          <span id="live-analysis-time" class="text-muted" style="font-size:12px;margin-left:auto"></span>
        </div>

        <div id="live-analysis-result">
          <div class="empty-state">
            <div class="empty-icon">‚ö°</div>
            <p>Clique em "Analisar Agora" para iniciar a an√°lise com dados Binance em tempo real</p>
          </div>
        </div>
      </div>

      <!-- =========================================
           PAGE: MERCADO
           ========================================= -->
      <div id="page-market" class="page">
        <div class="page-title">üíπ Mercado</div>
        <div class="page-subtitle">Pre√ßos e dados de mercado em tempo real via Binance</div>

        <div class="flex items-center gap-12 mb-16">
          <button class="btn btn-primary" onclick="loadMarketPage()">‚Üª Atualizar Pre√ßos</button>
          <span id="market-update-time" class="text-muted" style="font-size:12px;margin-left:auto"></span>
        </div>

        <!-- Price cards -->
        <div id="market-assets-grid" class="assets-grid">
          <div class="loading-overlay" style="grid-column:1/-1"><div class="spinner"></div> Carregando pre√ßos...</div>
        </div>

        <div class="mt-20">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Tabela de Pre√ßos</span>
              <span class="badge badge-blue">B3 / Crypto</span>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Ativo</th>
                    <th>Pre√ßo</th>
                    <th>Momentum Score</th>
                    <th>Classifica√ß√£o</th>
                    <th>Retorno %</th>
                    <th>Trend</th>
                  </tr>
                </thead>
                <tbody id="market-table-body">
                  <tr><td colspan="6" style="text-align:center;padding:24px;color:var(--text-muted)">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Top Oportunidades -->
        <div class="mt-20">
          <div class="card">
            <div class="card-header">
              <span class="card-title">üèÜ Top Oportunidades</span>
              <span class="badge badge-green">RSI + EMA + Volume + Not√≠cias</span>
            </div>
            <div style="padding:6px 0 12px;font-size:11px;color:var(--text-muted);border-bottom:1px solid var(--border);margin-bottom:16px">
              Score 0‚Äì100 combinando RSI, cruzamento EMA9/EMA21, volume relativo, proje√ß√£o matem√°tica e sentimento de not√≠cias RSS gratuito.
              <strong style="color:var(--yellow)">‚ö† N√£o √© recomenda√ß√£o financeira.</strong>
            </div>
            <div id="market-score-cards" class="assets-grid" style="margin-bottom:16px">
              <div class="loading-overlay" style="grid-column:1/-1"><div class="spinner"></div> Calculando scores...</div>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>#</th><th>Ativo</th><th>Score</th><th>RSI</th>
                    <th>EMA Signal</th><th>Vol. Ratio</th>
                    <th>Var. 1h</th><th>Var. 1 Dia</th><th>Not√≠cias</th>
                  </tr>
                </thead>
                <tbody id="market-score-tbody">
                  <tr><td colspan="9" style="text-align:center;padding:24px;color:var(--text-muted)">Calculando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Proje√ß√µes Matem√°ticas -->
        <div class="mt-20">
          <div class="card">
            <div class="card-header">
              <span class="card-title">üîÆ Proje√ß√µes Matem√°ticas de Pre√ßo</span>
              <span class="badge badge-blue">Regress√£o Linear + EMA</span>
            </div>
            <div style="padding:8px 0 12px;font-size:11px;color:var(--text-muted);border-bottom:1px solid var(--border);margin-bottom:12px">
              Estimativas baseadas em regress√£o linear (m√≠nimos quadrados) + extrapola√ß√£o EMA.
              Maior confian√ßa = menor variabilidade hist√≥rica dos res√≠duos.
              <strong style="color:var(--yellow)">‚ö† N√£o √© recomenda√ß√£o financeira.</strong>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Ativo</th>
                    <th>Pre√ßo Atual</th>
                    <th>Proje√ß√£o 1h</th>
                    <th>Var. 1h</th>
                    <th>Proje√ß√£o 1 Dia</th>
                    <th>Var. 1 Dia</th>
                    <th>Confian√ßa</th>
                  </tr>
                </thead>
                <tbody id="market-predict-tbody">
                  <tr><td colspan="7" style="text-align:center;padding:24px;color:var(--text-muted)">Carregando proje√ß√µes...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- =========================================
           PAGE: PORTF√ìLIO
           ========================================= -->
      <div id="page-portfolio" class="page">
        <div class="page-title">üíº Portf√≥lio</div>
        <div class="page-subtitle">Aloca√ß√£o de capital e recomenda√ß√µes por ativo</div>

        <div class="flex items-center gap-12 mb-16">
          <button class="btn btn-primary" onclick="loadPortfolio()">‚Üª Recalcular</button>
          <span id="portfolio-update-time" class="text-muted" style="font-size:12px;margin-left:auto"></span>
        </div>

        <!-- Banner capital + P&L do Trade -->
        <div class="card mb-16" style="padding:12px 16px">
          <div style="display:flex;flex-wrap:wrap;gap:24px;align-items:center">
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px">Capital do Bot</span>
              <span id="ptf-capital" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</span>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase">P&L Hoje</span>
              <span id="ptf-pnl-today" style="font-size:18px;font-weight:700">R$ --</span>
            </div>
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase">‚ö° 5min (20%)</span>
              <span id="ptf-pnl-5m" style="font-size:16px;font-weight:600">R$ --</span>
            </div>
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase">üïê 1h (35%)</span>
              <span id="ptf-pnl-1h" style="font-size:16px;font-weight:600">R$ --</span>
            </div>
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase">üìÖ 1d (45%)</span>
              <span id="ptf-pnl-1d" style="font-size:16px;font-weight:600">R$ --</span>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="display:flex;flex-direction:column;gap:2px">
              <span style="font-size:10px;color:var(--text-muted);text-transform:uppercase">P&L Total</span>
              <span id="ptf-pnl-total" style="font-size:18px;font-weight:700">R$ --</span>
            </div>
          </div>
        </div>

        <div class="cards-grid cards-2">
          <!-- Pie chart -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Distribui√ß√£o do Capital</span>
              <span id="portfolio-total" style="font-size:12px;color:var(--text-muted)"></span>
            </div>
            <div class="chart-container" style="height:280px">
              <canvas id="chart-portfolio-pie"></canvas>
            </div>
          </div>
          <!-- Summary -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Resumo da Aloca√ß√£o</span>
            </div>
            <div id="portfolio-summary">
              <div class="loading-overlay"><div class="spinner"></div> Calculando...</div>
            </div>
          </div>
        </div>

        <div class="card mt-16">
          <div class="card-header">
            <span class="card-title">A√ß√µes Recomendadas por Ativo</span>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Ativo</th>
                  <th>Classifica√ß√£o</th>
                  <th>Aloca√ß√£o Atual</th>
                  <th>Aloca√ß√£o Recomendada</th>
                  <th>Mudan√ßa %</th>
                  <th>A√ß√£o</th>
                </tr>
              </thead>
              <tbody id="portfolio-table-body">
                <tr><td colspan="6" style="text-align:center;padding:24px;color:var(--text-muted)">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- =========================================
           PAGE: RISCO
           ========================================= -->
      <div id="page-risk" class="page">
        <div class="page-title">üõ°Ô∏è Gest√£o de Risco</div>
        <div class="page-subtitle">Monitor IRQ, Stop Loss, limites di√°rios e de opera√ß√µes</div>

        <div class="flex items-center gap-12 mb-16">
          <button class="btn btn-primary" onclick="loadRiskPage()">‚Üª Atualizar</button>
          <span id="risk-update-time" class="text-muted" style="font-size:12px;margin-left:auto"></span>
        </div>

        <!-- Row 1: KPIs -->
        <div class="cards-grid cards-4" id="risk-kpis">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Pode Operar?</span>
              <div class="card-icon green">‚úÖ</div>
            </div>
            <div class="kpi-value" id="risk-can-trade">--</div>
            <div class="kpi-label" id="risk-can-trade-reason">--</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">P&L Di√°rio</span>
              <div class="card-icon blue">üìä</div>
            </div>
            <div class="kpi-value" id="risk-daily-pnl">R$ 0,00</div>
            <div class="kpi-label" id="risk-daily-pnl-label">Perda m√°x: R$ --</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Trades/Hora</span>
              <div class="card-icon yellow">‚è±Ô∏è</div>
            </div>
            <div class="kpi-value" id="risk-trades-hour">0 / 20</div>
            <div class="kpi-label">Limite por hora</div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Trades/Dia</span>
              <div class="card-icon purple">üìÖ</div>
            </div>
            <div class="kpi-value" id="risk-trades-day">0 / 100</div>
            <div class="kpi-label">Limite di√°rio total</div>
          </div>
        </div>

        <!-- Row 2: Stop Loss config + IRQ signals -->
        <div class="cards-grid cards-2 mt-16">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Configura√ß√µes de Prote√ß√£o</span>
              <span class="badge badge-green" id="risk-lock-badge">ATIVO</span>
            </div>
            <div id="risk-config-items"></div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Sinais IRQ (S1‚ÄìS5)</span>
              <span class="badge" id="risk-irq-badge-page">--</span>
            </div>
            <div id="risk-signals-list"></div>
          </div>
        </div>

        <!-- Row 3: daily limit progress + trade limit progress -->
        <div class="card mt-16">
          <div class="card-header">
            <span class="card-title">Limites de Prote√ß√£o</span>
          </div>
          <div id="risk-limits-section"></div>
        </div>
      </div>

      <!-- =========================================
           PAGE: HIST√ìRICO
           ========================================= -->
      <div id="page-history" class="page">
        <div class="page-title">üìö Hist√≥rico</div>
        <div class="page-subtitle">Hist√≥rico de an√°lises e opera√ß√µes registradas no banco de dados</div>

        <div class="tabs">
          <div class="tab active" onclick="switchTab(this, 'tab-analysis')">An√°lises</div>
          <div class="tab" onclick="switchTab(this, 'tab-trades')">Trades</div>
          <div class="tab" onclick="switchTab(this, 'tab-dbstats')">Banco de Dados</div>
        </div>

        <div class="tab-pane active" id="tab-analysis">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Hist√≥rico de An√°lises</span>
              <button class="btn btn-secondary btn-sm" onclick="loadHistoryAnalysis()">‚Üª</button>
            </div>
            <div id="history-analysis-content">
              <div class="loading-overlay"><div class="spinner"></div> Carregando...</div>
            </div>
          </div>
        </div>

        <div class="tab-pane" id="tab-trades">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Trades Executados</span>
              <button class="btn btn-secondary btn-sm" onclick="loadHistoryTrades()">‚Üª</button>
            </div>
            <div id="history-trades-content">
              <div class="loading-overlay"><div class="spinner"></div> Carregando...</div>
            </div>
          </div>
        </div>

        <div class="tab-pane" id="tab-dbstats">
          <div class="cards-grid cards-3" id="db-stats-cards">
            <div class="loading-overlay" style="grid-column:1/-1"><div class="spinner"></div> Carregando...</div>
          </div>
        </div>
      </div>

      <!-- =========================================
           PAGE: TRADE
           ========================================= -->
      <div id="page-trade" class="page">
        <div class="page-title">üí± Trade</div>
        <div class="page-subtitle">Deposite capital, controle o bot e acompanhe todas as opera√ß√µes</div>

        <!-- Status Bar -->
        <div class="card mb-16" style="padding:12px 18px">
          <div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap">
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:12px;color:var(--text-muted)">STATUS BOT:</span>
              <span id="trade-bot-badge" class="badge badge-gray">‚Äî</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:12px;color:var(--text-muted)">CAPITAL:</span>
              <span id="trade-capital-badge" style="font-size:13px;font-weight:700;color:var(--green)">R$ --</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:12px;color:var(--text-muted)">SESS√ÉO:</span>
              <span id="trade-session-badge" class="badge badge-blue">‚Äî</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:12px;color:var(--text-muted)">√öLTIMO CICLO:</span>
              <span id="trade-last-cycle" style="font-size:12px;color:var(--text-muted)">‚Äî</span>
            </div>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button class="btn btn-secondary" onclick="loadTradePage()">‚Üª Atualizar</button>
              <button id="trade-toggle-btn" class="btn btn-primary" onclick="toggleTrading()">‚ñ∂ Iniciar Bot</button>
              <button class="btn btn-secondary" onclick="runTradeCycle()">üîÑ Executar Ciclo</button>
            </div>
          </div>
        </div>

        <!-- Row 1: Capital deposit + Summary cards -->
        <div class="cards-grid cards-3 mb-16">

          <!-- Depositar Capital -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">üí∞ Capital do Bot</span>
              <span class="badge badge-blue">Dep√≥sito</span>
            </div>
            <div style="margin-bottom:12px">
              <label style="font-size:11px;color:var(--text-muted);margin-bottom:6px;display:block">VALOR EM R$</label>
              <div style="display:flex;gap:8px">
                <input id="trade-capital-input" type="number" min="10" step="10"
                  placeholder="Ex: 500"
                  style="flex:1;background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-primary);padding:8px 12px;border-radius:6px;font-size:14px"/>
                <button class="btn btn-primary" onclick="depositCapital()">Depositar</button>
              </div>
            </div>
            <div style="border-top:1px solid var(--border);padding-top:12px">
              <div style="display:flex;justify-content:space-between;margin-bottom:6px">
                <span style="font-size:12px;color:var(--text-muted)">Capital atual</span>
                <span id="trade-current-capital" style="font-size:13px;font-weight:700;color:var(--text-primary)">R$ --</span>
              </div>
              <div style="display:flex;justify-content:space-between">
                <span style="font-size:12px;color:var(--text-muted)">P&L Total</span>
                <span id="trade-total-pnl" style="font-size:13px;font-weight:700">R$ 0,00</span>
              </div>
            </div>
          </div>

          <!-- Posi√ß√µes Ativas -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">üìä Posi√ß√µes Ativas</span>
              <span id="trade-positions-count" class="badge badge-gray">0 ativos</span>
            </div>
            <div id="trade-positions-mini"
              style="display:flex;flex-direction:column;gap:6px;max-height:120px;overflow-y:auto">
              <div class="empty-state" style="padding:16px"><p style="font-size:12px">Sem posi√ß√µes</p></div>
            </div>
          </div>

          <!-- Distribui√ß√£o -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">ü•ß Distribui√ß√£o</span>
            </div>
            <div class="chart-container" style="height:140px">
              <canvas id="chart-trade-donut"></canvas>
            </div>
          </div>

        </div>

        <!-- Row 1.5: Valor Total -->
        <div class="card mb-16">
          <div class="card-header">
            <span class="card-title">üí∞ Desempenho por Timeframe</span>
            <span class="badge badge-blue">Capital: <span id="trade-capital-display">R$ --</span></span>
          </div>
          <!-- Linha 1: P&L por timeframe -->
          <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:space-around;padding:12px 4px 8px">
            <div style="text-align:center;min-width:100px;flex:1">
              <div style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">‚ö° 5 MIN</div>
              <div id="trade-gain-5m" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</div>
              <div style="font-size:10px;color:var(--text-muted);margin-top:2px">20% capital</div>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="text-align:center;min-width:100px;flex:1">
              <div style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">üïê 1 HORA</div>
              <div id="trade-gain-1h" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</div>
              <div style="font-size:10px;color:var(--text-muted);margin-top:2px">35% capital</div>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="text-align:center;min-width:100px;flex:1">
              <div style="font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">üìÖ 1 DIA</div>
              <div id="trade-gain-1d" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</div>
              <div style="font-size:10px;color:var(--text-muted);margin-top:2px">45% capital</div>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="text-align:center;min-width:100px;flex:1">
              <div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Ganho Hoje</div>
              <div id="trade-gain-today" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</div>
              <div id="trade-gain-today-cycles" style="font-size:10px;color:var(--text-muted);margin-top:2px">‚Äî ciclos hoje</div>
            </div>
            <div style="width:1px;background:var(--border);align-self:stretch"></div>
            <div style="text-align:center;min-width:100px;flex:1">
              <div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px">Ganho Total</div>
              <div id="trade-gain-total" style="font-size:22px;font-weight:800;color:var(--text-primary)">R$ --</div>
              <div id="trade-gain-total-cycles" style="font-size:10px;color:var(--text-muted);margin-top:2px">‚Äî ciclos totais</div>
            </div>
          </div>
          <!-- Reinvestimento info -->
          <div id="trade-reinvest-info" style="display:none;text-align:center;padding:6px 12px;background:var(--bg-secondary);border-radius:6px;margin:8px;font-size:11px;color:var(--text-muted)">
            üí∞ Reinvestimento autom√°tico ativo ‚Äî lucros reinvestidos ao final de cada dia √†s 17h BRT
          </div>
        </div>

        <!-- Row 2: Positions table -->
        <div class="card mb-16">
          <div class="card-header">
            <span class="card-title">üìà Onde o Bot Est√° Aplicando</span>
            <span id="trade-cycle-time" style="font-size:11px;color:var(--text-muted)"></span>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ATIVO</th>
                  <th>CLASSIFICA√á√ÉO</th>
                  <th>VALOR ALOCADO</th>
                  <th>% DO CAPITAL</th>
                  <th>VARIA√á√ÉO</th>
                  <th>A√á√ÉO</th>
                </tr>
              </thead>
              <tbody id="trade-positions-tbody">
                <tr><td colspan="6" style="text-align:center;padding:24px;color:var(--text-muted)">Execute um ciclo para ver as posi√ß√µes</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Row 3: Full activity log -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">üìã Hist√≥rico Completo de Atividade</span>
            <div style="display:flex;gap:8px;align-items:center">
              <select id="trade-log-filter"
                style="background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-primary);padding:4px 8px;border-radius:6px;font-size:12px"
                onchange="filterTradeLog()">
                <option value="all">Todos</option>
                <option value="COMPRA">Compras</option>
                <option value="VENDA">Vendas</option>
                <option value="HOLD">Hold</option>
                <option value="DEP√ìSITO">Dep√≥sitos</option>
                <option value="SISTEMA">Sistema</option>
                <option value="CICLO">Ciclos</option>
              </select>
              <button class="btn btn-secondary btn-sm" onclick="clearTradeLog()">üóë Limpar</button>
            </div>
          </div>
          <div class="table-wrap" style="max-height:420px;overflow-y:auto">
            <table>
              <thead>
                <tr>
                  <th>DATA/HORA</th>
                  <th>TIPO</th>
                  <th>ATIVO</th>
                  <th>VALOR</th>
                  <th>DESCRI√á√ÉO</th>
                </tr>
              </thead>
              <tbody id="trade-log-tbody">
                <tr><td colspan="5" style="text-align:center;padding:24px;color:var(--text-muted)">Nenhum evento registrado</td></tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

      <!-- =========================================
           PAGE: CONFIGURA√á√ïES
           ========================================= -->
      <div id="page-settings" class="page">
        <div class="page-title">‚öôÔ∏è Configura√ß√µes</div>
        <div class="page-subtitle">Status dos m√≥dulos e configura√ß√µes do sistema</div>

        <!-- Module status -->
        <div class="cards-grid cards-2 mb-16">
          <div class="card">
            <div class="card-header">
              <span class="card-title">M√≥dulos do Sistema</span>
              <button class="btn btn-secondary btn-sm" onclick="loadSettings()">‚Üª</button>
            </div>
            <div id="settings-modules"></div>
          </div>
          <div class="card">
            <div class="card-header">
              <span class="card-title">Configura√ß√µes do Bot</span>
            </div>
            <div id="settings-config"></div>
          </div>
        </div>

        <!-- API endpoint config -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">Conex√£o com API</span>
          </div>
          <div style="display:flex;gap:12px;align-items:center;padding:8px 0">
            <input
              id="api-url-input"
              type="text"
              value="http://localhost:8001"
              style="flex:1;background:var(--bg-tertiary);border:1px solid var(--border);color:var(--text-primary);padding:8px 12px;border-radius:6px;font-size:13px"
              placeholder="http://localhost:8001"
            />
            <button class="btn btn-primary" onclick="applyApiUrl()">Conectar</button>
          </div>
          <div style="margin-top:8px;font-size:12px;color:var(--text-muted)">
            URL base da API FastAPI do Day Trade Bot
          </div>
        </div>

        <!-- Endpoints overview -->
        <div class="card mt-16">
          <div class="card-header">
            <span class="card-title">Endpoints Dispon√≠veis</span>
            <a id="swagger-link" href="http://localhost:8001/docs" target="_blank" class="btn btn-secondary btn-sm">
              üìñ Swagger UI
            </a>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>M√©todo</th><th>Endpoint</th><th>Descri√ß√£o</th></tr>
              </thead>
              <tbody>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/</td><td>Status do bot</td></tr>
                <tr><td><span class="badge badge-green">POST</span></td><td class="monospace">/analyze/full</td><td>An√°lise completa (dados de teste)</td></tr>
                <tr><td><span class="badge badge-green">POST</span></td><td class="monospace">/market/analyze-live</td><td>An√°lise ao vivo com Binance</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/market/prices</td><td>Pre√ßos em tempo real</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/market/klines/{asset}</td><td>Candles hist√≥ricos</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/risk/status</td><td>Status do gestor de risco</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/risk/can-trade</td><td>Verificar se pode operar</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/db/stats</td><td>Estat√≠sticas do banco</td></tr>
                <tr><td><span class="badge badge-blue">GET</span></td><td class="monospace">/modules</td><td>Status dos m√≥dulos</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </main>
  </div><!-- /main-content -->

</div><!-- /app-layout -->

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toast-container"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="app.js"></script>
</body>
</html>
